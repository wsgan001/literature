Tapestry.FormEventManager.addMethods({handleSubmit:function(b){Event.extend(b);var a=$T(this.form);a.validationError=false;this.form.fire(Tapestry.FORM_PREPARE_FOR_SUBMIT_EVENT,this.form);if(this.form.hasClassName(Tapestry.PREVENT_SUBMISSION)){b.stop();this.form.fire(Tapestry.FORM_PROCESS_SUBMIT_EVENT);return false}return true}});Tapestry.FieldEventManager.addMethods({initialize:function(b){this.field=$(b);var c=this.field.id;var a=$(this.field.form).getFormEventManager();if(c&&a.validateOnBlur){this.translator=Prototype.K;document.observe(Tapestry.FOCUS_CHANGE_EVENT,function(d){if(Tapestry.currentFocusField==this.field&&this.field.form==d.memo.form){this.validateInput()}}.bindAsEventListener(this))}},removeDecorations:function(){this.field.removeClassName("t-error");if(this.getLabel()){if(this.getIcon()){this.getIcon().hide();this.getLabel().insert(this.getIcon())}var a=this.field.id+":error";if(!this.errorMessage){this.errorMessage=$(a)}if(this.errorMessage){Element.remove(this.errorMessage);this.errorMessage=null}}},showValidationMessage:function(c){$T(this.field).validationError=true;$T(this.field.form).validationError=true;this.field.addClassName("t-error");if(this.getLabel()){var d=new Element("div",{"class":"clear"});d.appendChild(new Element("div",{"class":"error-tl"}));d.appendChild(new Element("div",{"class":"error-tr"}));d.appendChild(new Element("div",{"class":"error-bl"}));d.appendChild(new Element("div",{"class":"error-br"}));var a=this.field.id+":error";if(!this.errorMessage){this.errorMessage=$(a)}if(!this.errorMessage){this.errorMessage=new Element("span",{id:a,"class":"t-error"});this.getLabel().insert({bottom:this.errorMessage})}var b=this.getIcon();this.errorMessage.update(c);this.errorMessage.insert({top:b});this.errorMessage.insert({top:d});if(b!=null){b.show()}}}});Tapestry.Validator.pqemail=function(b,a){b.addValidator(function(c){if(!Tapestry.Validator.pqemail.validate(c)){throw a}})};Tapestry.Validator.pqemail.validate=function(b){if(b.length==0){return true}var q=/^(.+)@(.+)$/;var o='\\(\\)><@,;:\\\\\\"\\.\\[\\]';var j="[^\\s"+o+"]";var d='("[^"]*")';var p=/^\[(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})\]$/;var a=j+"+";var n="("+a+"|"+d+")";var k=new RegExp("^"+n+"(\\."+n+")*$");var f=new RegExp("^"+a+"(\\."+a+")*$");var c=b.match(q);if(c==null){return false}var s=c[1];var t=c[2];for(l=0;l<s.length;l++){if(s.charCodeAt(l)>127){return false}}for(l=0;l<t.length;l++){if(t.charCodeAt(l)>127){return false}}if(s.match(k)==null){return false}var h=t.match(p);if(h!=null){for(var l=1;l<=4;l++){if(h[l]>255){return false}}return true}var g=new RegExp("^"+a+"$");var e=t.split(".");var m=e.length;for(l=0;l<m;l++){if(e[l].search(g)==-1){return false}}if(m<2){return false}return true};function browserCheck(){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var c=navigator.userAgent;var d=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(d.exec(c)!=null){e=parseFloat(RegExp.$1)}}var a=e;var b=document.cookie.indexOf("donotremind");if(a==6){if(b==-1){Overlay.box.showOverlay("browserInfoOverlay")}}}function setDoNotAsk(){if($("browserInfoForm").chkResults.checked){var b=new Date();var a=7;b.setTime(b.getTime()+(1000*60*60*24*a));document.cookie="donotremind=yes; expires="+b.toGMTString()}}document.observe("dom:loaded",function(){browserCheck.defer()});var popupClassesHash=new Hash({popUpHelp:"width=790,height=480,resizable=1,toolbar=1,location=1,directories=0,addressbar=1,scrollbars=1,status=0,menubar=0",popUpSmall:"width=680,height=360,resizable=1,toolbar=1,location=0,directories=0,addressbar=1,scrollbars=1,status=0,menubar=0",popUpMulti:"width=680,height=500,resizable=1,toolbar=1,location=1,directories=0,addressbar=1,scrollbars=1,status=0,menubar=0",externalLink:"width=600,height=480,resizable=1,toolbar=1,location=1,directories=0,addressbar=1,scrollbars=1,status=0,menubar=0",externalWidget:"resizable=0,toolbar=0,location=0,directories=0,addressbar=0,scrollbars=0,status=0,menubar=0"});var PopupWindowLinks=Class.create({initialize:function(){Event.observe(document,"click",this.clickPopupLink.bindAsEventListener(this))},clickPopupLink:function(e){if(this.getTargetType(e)=="A"){var d=this.checkClasses(e);if(d&&d.indexOf("popUpHelp")==-1){e.stop();if(!this.link){this.link=e.findElement("a")}if(d=="externalWidget"){var a=this.link.getAttribute("data-height");var c=this.link.getAttribute("data-width");var b="width="+c+",height="+a+","+popupClassesHash.get(d);var f=window.open(this.link.href,"ExternalWidget",b);f.focus()}else{if(d=="linkInLayer"){Tips.hideAll()}else{window.open(this.link.href,"",popupClassesHash.get(d))}}this.link=null}}},getTargetType:function(a){var b;if(Prototype.Browser.IE&&a.srcElement){b=a.srcElement.nodeName}else{this.link=a.findElement("a");if(this.link&&this.link.nodeName){b=this.link.nodeName}}return b},getClassName:function(a){if(Prototype.Browser.IE&&a.srcElement){return a.srcElement.className}else{return this.link.className}},checkClasses:function(a){this.className=this.getClassName(a);if(this.containsClass("popUpHelp")){return"popUpHelp"}else{if(this.containsClass("popUpSmall")){return"popUpSmall"}else{if(this.containsClass("popUpMulti")){return"popUpMulti"}else{if(this.containsClass("externalLink")){return"externalLink"}else{if(this.containsClass("externalWidget")){return"externalWidget"}else{if(this.containsClass("linkInLayer")){return"linkInLayer"}}}}}}return null},containsClass:function(a){var b=this.className;return(b.length>0&&(b==a||new RegExp("(^|\\s)"+a+"(\\s|$)").test(b)))}});var popupWindowLinksVar;Tapestry.Initializer.popupWindowLinks=function(){if(!popupWindowLinksVar){popupWindowLinksVar=new PopupWindowLinks()}};function newPopup(a){popupWindow=window.open(a,"popUpWindow","width=790,height=480,resizable=1,toolbar=1,location=1,directories=0,addressbar=1,scrollbars=1,status=0,menubar=0");popupWindow.focus()}function alwaysNewPopup(a){popupWindow=window.open(a,"_blank","width=790,height=480,resizable=1,toolbar=1,location=1,directories=0,addressbar=1,scrollbars=1,status=0,menubar=0")}if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(b,c,a){b=$(b);this.element=b;this.update=$(c);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(a)}else{this.options=a||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(d,e){if(!e.style.position||e.style.position=="absolute"){e.style.position="absolute";Position.clone(d,e,{setHeight:false,offsetTop:d.offsetHeight})}Effect.Appear(e,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,e){new Effect.Fade(e,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(a){if(this.active){switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}}else{if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&a.keyCode==0)){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(b){var a=Event.findElement(b,"LI");if(this.index!=a.autocompleteIndex){this.index=a.autocompleteIndex;this.render()}Event.stop(b)},onClick:function(b){var a=Event.findElement(b,"LI");this.index=a.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(a){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++){this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index).scrollIntoView(false)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(f){if(this.options.updateElement){this.options.updateElement(f);return}var d="";if(this.options.select){var a=$(f).select("."+this.options.select)||[];if(a.length>0){d=Element.collectTextNodes(a[0],this.options.select)}}else{d=Element.collectTextNodesIgnoreClass(f,"informal")}var c=this.getTokenBounds();if(c[0]!=-1){var e=this.element.value.substr(0,c[0]);var b=this.element.value.substr(c[0]).match(/^\s+/);if(b){e+=b[0]}this.element.value=e+d+this.element.value.substr(c[1])}else{this.element.value=d}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,f)}},updateChoices:function(c){if(!this.changed&&this.hasFocus){this.update.innerHTML=c;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var e=this.element.value;if(e.strip().empty()){return[-1,0]}var f=arguments.callee.getFirstDifferencePos(e,this.oldElementValue);var h=(f==this.oldElementValue.length?1:0);var d=-1,c=e.length;var g;for(var b=0,a=this.options.tokens.length;b<a;++b){g=e.lastIndexOf(this.options.tokens[b],f+h-1);if(g>d){d=g}g=e.indexOf(this.options.tokens[b],f+h);if(-1!=g&&g<c){c=g}}return(this.tokenBounds=[d+1,c])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(c,a){var d=Math.min(c.length,a.length);for(var b=0;b<d;++b){if(c[b]!=a[b]){return b}}return d};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(c,d,b,a){this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=b},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(b,d,c,a){this.baseInitialize(b,d,a);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){var d=[];var c=[];var h=b.getToken();var g=0;for(var e=0;e<b.options.array.length&&d.length<b.options.choices;e++){var f=b.options.array[e];var j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase()):f.indexOf(h);while(j!=-1){if(j==0&&f.length!=h.length){d.push("<li><strong>"+f.substr(0,h.length)+"</strong>"+f.substr(h.length)+"</li>");break}else{if(h.length>=b.options.partialChars&&b.options.partialSearch&&j!=-1){if(b.options.fullSearch||/\s/.test(f.substr(j-1,1))){c.push("<li>"+f.substr(0,j)+"<strong>"+f.substr(j,h.length)+"</strong>"+f.substr(j+h.length)+"</li>");break}}}j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase(),j+1):f.indexOf(h,j+1)}}if(c.length){d=d.concat(c.slice(0,b.options.choices-d.length))}return"<ul>"+d.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(c,b,a){this.url=b;this.element=c=$(c);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(a);Object.extend(this.options,a||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){if(!this._editing||a.ctrlKey||a.altKey||a.shiftKey){return}if(Event.KEY_ESC==a.keyCode){this.handleFormCancellation(a)}else{if(Event.KEY_RETURN==a.keyCode){this.handleFormSubmission(a)}}},createControl:function(g,c,b){var e=this.options[g+"Control"];var f=this.options[g+"Text"];if("button"==e){var a=document.createElement("input");a.type="submit";a.value=f;a.className="editor_"+g+"_button";if("cancel"==g){a.onclick=this._boundCancelHandler}this._form.appendChild(a);this._controls[g]=a}else{if("link"==e){var d=document.createElement("a");d.href="#";d.appendChild(document.createTextNode(f));d.onclick="cancel"==g?this._boundCancelHandler:this._boundSubmitHandler;d.className="editor_"+g+"_link";if(b){d.className+=" "+b}this._form.appendChild(d);this._controls[g]=d}}},createEditField:function(){var c=(this.options.loadTextURL?this.options.loadingText:this.getText());var b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var a=this.options.size||this.options.cols||0;if(0<a){b.size=a}}else{b=document.createElement("textarea");b.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);b.cols=this.options.cols||40}b.name=this.options.paramName;b.value=c;b.className="editor_field";if(this.options.submitOnBlur){b.onblur=this._boundSubmitHandler}this._controls.editor=b;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var b=this;function a(d,e){var c=b.options["text"+d+"Controls"];if(!c||e===false){return}b._form.appendChild(document.createTextNode(c))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(this._saving||this._editing){return}this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(a){Event.stop(a)}},enterHover:function(a){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){this.wrapUp();if(a){Event.stop(a)}},handleFormSubmission:function(d){var b=this._form;var c=$F(this._controls.editor);this.prepareSubmission();var f=this.options.callback(b,c)||"";if(Object.isString(f)){f=f.toQueryParams()}f.editorId=this.element.id;if(this.options.htmlResponse){var a=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(a,{parameters:f,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,a)}else{var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:f,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,a)}if(d){Event.stop(d)}},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(a){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(c){this._form.removeClassName(this.options.loadingClassName);var b=c.responseText;if(this.options.stripLoadedTextTags){b=b.stripTags()}this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a){$(this._controls.editor)["focus"==a?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;if(!this.options.externalControlOnly){this.element.observe(b.key,a)}if(this.options.externalControl){this.options.externalControl.observe(b.key,a)}}.bind(this))},removeForm:function(){if(!this._form){return}this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(b,a){if("function"==typeof this.options[b]){this.options[b](this,a)}},unregisterListeners:function(){$H(this._listeners).each(function(a){if(!this.options.externalControlOnly){this.element.stopObserving(a.key,a.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(a.key,a.value)}}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,c,b,a){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(c,b,a)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw ("Server returned an invalid collection representation.")}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(b){this._controls.editor.disabled=true;var a=this._controls.editor.firstChild;if(!a){a=document.createElement("option");a.value="";this._controls.editor.appendChild(a);a.selected=true}a.update((b||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(d){return 2===d.length?d:[d,d].flatten()});var b=("value" in this.options)?this.options.value:this._text;var a=this._collection.any(function(d){return d[0]==b}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(e,d){c=document.createElement("option");c.value=e[0];c.selected=a?e[0]==b:0==d;c.appendChild(document.createTextNode(e[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){if(!a){return}function b(c,d){if(c in a||d===undefined){return}a[c]=d}b("cancelControl",(a.cancelLink?"link":(a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined)));b("okControl",(a.okLink?"link":(a.okButton?"button":a.okLink==a.okButton==false?false:undefined)));b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(b,a){new Effect.Highlight(a,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;if(a._effect){a._effect.cancel()}},onFailure:function(b,a){alert("Error communication with the server: "+b.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(b,a,c){this.delay=a||0.5;this.element=$(b);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(a){if(this.lastValue==$F(this.element)){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});if(!Control){var Control={}}Control.Slider=Class.create({initialize:function(d,a,b){var c=this;if(Object.isArray(d)){this.handles=d.collect(function(f){return $(f)})}else{this.handles=[$(d)]}this.track=$(a);this.options=b||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(e){return $(e)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(f,e){e=c.handles.length-1-e;c.setValue(parseFloat((Object.isArray(c.options.sliderValue)?c.options.sliderValue[e]:c.options.sliderValue)||c.range.start),e);f.makePositioned().observe("mousedown",c.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max()){return(this.allowedValues.max())}if(a<=this.allowedValues.min()){return(this.allowedValues.min())}var c=Math.abs(this.allowedValues[0]-a);var b=this.allowedValues[0];this.allowedValues.each(function(d){var e=Math.abs(d-a);if(e<=c){b=d;c=e}});return b}if(a>this.range.end){return this.range.end}if(a<this.range.start){return this.range.start}return a},setValue:function(b,a){if(!this.active){this.activeHandleIdx=a||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}a=a||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((a>0)&&(b<this.values[a-1])){b=this.values[a-1]}if((a<(this.handles.length-1))&&(b>this.values[a+1])){b=this.values[a+1]}}b=this.getNearestValue(b);this.values[a]=b;this.value=this.values[0];this.handles[a].style[this.isVertical()?"top":"left"]=this.translateToPx(b);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(b,a){this.setValue(this.values[a||this.activeHandleIdx||0]+b,a||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(a-this.range.start))+"px"},translateToValue:function(a){return((a/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)},getRange:function(b){var a=this.values.sortBy(Prototype.K);b=b||0;return $R(a[b],a[b+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var a=this;if(this.spans){$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(b,a){if(this.isVertical()){b.style.top=this.translateToPx(a.start);b.style.height=this.translateToPx(a.end-a.start+this.range.start)}else{b.style.left=this.translateToPx(a.start);b.style.width=this.translateToPx(a.end-a.start+this.range.start)}},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(c){if(Event.isLeftClick(c)){if(!this.disabled){this.active=true;var d=Event.element(c);var e=[Event.pointerX(c),Event.pointerY(c)];var a=d;if(a==this.track){var b=this.track.cumulativeOffset();this.event=c;this.setValue(this.translateToValue((this.isVertical()?e[1]-b[1]:e[0]-b[0])-(this.handleLength/2)));var b=this.activeHandle.cumulativeOffset();this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}else{while((this.handles.indexOf(d)==-1)&&d.parentNode){d=d.parentNode}if(this.handles.indexOf(d)!=-1){this.activeHandle=d;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var b=this.activeHandle.cumulativeOffset();this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}}}Event.stop(c)}},update:function(a){if(this.active){if(!this.dragging){this.dragging=true}this.draw(a);if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(a)}},draw:function(b){var c=[Event.pointerX(b),Event.pointerY(b)];var a=this.track.cumulativeOffset();c[0]-=this.offsetX+a[0];c[1]-=this.offsetY+a[1];this.event=b;this.setValue(this.translateToValue(this.isVertical()?c[1]:c[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(a){if(this.active&&this.dragging){this.finishDrag(a,true);Event.stop(a)}this.active=false;this.dragging=false},finishDrag:function(a,b){this.active=false;this.dragging=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null}});if(Object.isUndefined(Effect)){throw ("dragdrop.js requires including script.aculo.us' effects.js library")}var Droppables={drops:[],remove:function(a){this.drops=this.drops.reject(function(b){return b.element==$(a)})},add:function(b){b=$(b);var a=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(a.containment){a._containers=[];var c=a.containment;if(Object.isArray(c)){c.each(function(d){a._containers.push($(d))})}else{a._containers.push($(c))}}if(a.accept){a.accept=[a.accept].flatten()}Element.makePositioned(b);a.element=b;this.drops.push(a)},findDeepestChild:function(a){deepest=a[0];for(i=1;i<a.length;++i){if(Element.isParent(a[i].element,deepest.element)){deepest=a[i]}}return deepest},isContained:function(b,a){var c;if(a.tree){c=b.treeNode}else{c=b.parentNode}return a._containers.detect(function(d){return c==d})},isAffected:function(a,c,b){return((b.element!=c)&&((!b._containers)||this.isContained(c,b))&&((!b.accept)||(Element.classNames(c).detect(function(d){return b.accept.include(d)})))&&Position.within(b.element,a[0],a[1]))},deactivate:function(a){if(a.hoverclass){Element.removeClassName(a.element,a.hoverclass)}this.last_active=null},activate:function(a){if(a.hoverclass){Element.addClassName(a.element,a.hoverclass)}this.last_active=a},show:function(a,c){if(!this.drops.length){return}var b,d=[];this.drops.each(function(e){if(Droppables.isAffected(a,c,e)){d.push(e)}});if(d.length>0){b=Droppables.findDeepestChild(d)}if(this.last_active&&this.last_active!=b){this.deactivate(this.last_active)}if(b){Position.within(b.element,a[0],a[1]);if(b.onHover){b.onHover(c,b.element,Position.overlap(b.overlap,b.element))}if(b!=this.last_active){Droppables.activate(b)}}},fire:function(b,a){if(!this.last_active){return}Position.prepare();if(this.isAffected([Event.pointerX(b),Event.pointerY(b)],a,this.last_active)){if(this.last_active.onDrop){this.last_active.onDrop(a,this.last_active.element,b);return true}}},reset:function(){if(this.last_active){this.deactivate(this.last_active)}}};var Draggables={drags:[],observers:[],register:function(a){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)}this.drags.push(a)},unregister:function(a){this.drags=this.drags.reject(function(b){return b==a});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)}},activate:function(a){if(a.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=a}.bind(this),a.options.delay)}else{window.focus();this.activeDraggable=a}},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(!this.activeDraggable){return}var b=[Event.pointerX(a),Event.pointerY(a)];if(this._lastPointer&&(this._lastPointer.inspect()==b.inspect())){return}this._lastPointer=b;this.activeDraggable.updateDrag(a,b)},endDrag:function(a){if(this._timeout){clearTimeout(this._timeout);this._timeout=null}if(!this.activeDraggable){return}this._lastPointer=null;this.activeDraggable.endDrag(a);this.activeDraggable=null},keyPress:function(a){if(this.activeDraggable){this.activeDraggable.keyPress(a)}},addObserver:function(a){this.observers.push(a);this._cacheObserverCallbacks()},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b.element==a});this._cacheObserverCallbacks()},notify:function(b,a,c){if(this[b+"Count"]>0){this.observers.each(function(d){if(d[b]){d[b](b,a,c)}})}if(a.options[b]){a.options[b](a,c)}},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(a){Draggables[a+"Count"]=Draggables.observers.select(function(b){return b[a]}).length})}};var Draggable=Class.create({initialize:function(b){var c={handle:false,reverteffect:function(f,e,d){var g=Math.sqrt(Math.abs(e^2)+Math.abs(d^2))*0.02;new Effect.Move(f,{x:-d,y:-e,duration:g,queue:{scope:"_draggable",position:"end"}})},endeffect:function(e){var d=Object.isNumber(e._opacity)?e._opacity:1;new Effect.Opacity(e,{duration:0.2,from:0.7,to:d,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[e]=false}})},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect)){Object.extend(c,{starteffect:function(d){d._opacity=Element.getOpacity(d);Draggable._dragging[d]=true;new Effect.Opacity(d,{duration:0.2,from:d._opacity,to:0.7})}})}var a=Object.extend(c,arguments[1]||{});this.element=$(b);if(a.handle&&Object.isString(a.handle)){this.handle=this.element.down("."+a.handle,0)}if(!this.handle){this.handle=$(a.handle)}if(!this.handle){this.handle=this.element}if(a.scroll&&!a.scroll.scrollTo&&!a.scroll.outerHTML){a.scroll=$(a.scroll);this._isScrollChild=Element.childOf(this.element,a.scroll)}Element.makePositioned(this.element);this.options=a;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return([parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")])},initDrag:function(a){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]){return}if(Event.isLeftClick(a)){var c=Event.element(a);if((tag_name=c.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return}var b=[Event.pointerX(a),Event.pointerY(a)];var d=this.element.cumulativeOffset();this.offset=[0,1].map(function(e){return(b[e]-d[e])});Draggables.activate(this);Event.stop(a)}},startDrag:function(b){this.dragging=true;if(!this.delta){this.delta=this.currentDelta()}if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex}if(this.options.ghosting){this._clone=this.element.cloneNode(true);this._originallyAbsolute=(this.element.getStyle("position")=="absolute");if(!this._originallyAbsolute){Position.absolutize(this.element)}this.element.parentNode.insertBefore(this._clone,this.element)}if(this.options.scroll){if(this.options.scroll==window){var a=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=a.left;this.originalScrollTop=a.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop}}Draggables.notify("onStart",this,b);if(this.options.starteffect){this.options.starteffect(this.element)}},updateDrag:function(event,pointer){if(!this.dragging){this.startDrag(event)}if(!this.options.quiet){Position.prepare();Droppables.show(pointer,this.element)}Draggables.notify("onDrag",this,event);this.draw(pointer);if(this.options.change){this.options.change(this)}if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height]}}else{p=Position.page(this.options.scroll).toArray();p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight)}var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity)}if(pointer[1]<(p[1]+this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity)}if(pointer[0]>(p[2]-this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity)}if(pointer[1]>(p[3]-this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity)}this.startScrolling(speed)}if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(event)},finishDrag:function(b,f){this.dragging=false;if(this.options.quiet){Position.prepare();var e=[Event.pointerX(b),Event.pointerY(b)];Droppables.show(e,this.element)}if(this.options.ghosting){if(!this._originallyAbsolute){Position.relativize(this.element)}delete this._originallyAbsolute;Element.remove(this._clone);this._clone=null}var g=false;if(f){g=Droppables.fire(b,this.element);if(!g){g=false}}if(g&&this.options.onDropped){this.options.onDropped(this.element)}Draggables.notify("onEnd",this,b);var a=this.options.revert;if(a&&Object.isFunction(a)){a=a(this.element)}var c=this.currentDelta();if(a&&this.options.reverteffect){if(g==0||a!="failure"){this.options.reverteffect(this.element,c[1]-this.delta[1],c[0]-this.delta[0])}}else{this.delta=c}if(this.options.zindex){this.element.style.zIndex=this.originalZ}if(this.options.endeffect){this.options.endeffect(this.element)}Draggables.deactivate(this);Droppables.reset()},keyPress:function(a){if(a.keyCode!=Event.KEY_ESC){return}this.finishDrag(a,false);Event.stop(a)},endDrag:function(a){if(!this.dragging){return}this.stopScrolling();this.finishDrag(a,true);Event.stop(a)},draw:function(a){var g=this.element.cumulativeOffset();if(this.options.ghosting){var c=Position.realOffset(this.element);g[0]+=c[0]-Position.deltaX;g[1]+=c[1]-Position.deltaY}var f=this.currentDelta();g[0]-=f[0];g[1]-=f[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){g[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;g[1]-=this.options.scroll.scrollTop-this.originalScrollTop}var e=[0,1].map(function(d){return(a[d]-g[d]-this.offset[d])}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){e=this.options.snap(e[0],e[1],this)}else{if(Object.isArray(this.options.snap)){e=e.map(function(d,h){return(d/this.options.snap[h]).round()*this.options.snap[h]}.bind(this))}else{e=e.map(function(d){return(d/this.options.snap).round()*this.options.snap}.bind(this))}}}var b=this.element.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){b.left=e[0]+"px"}if((!this.options.constraint)||(this.options.constraint=="vertical")){b.top=e[1]+"px"}if(b.visibility=="hidden"){b.visibility=""}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null}},startScrolling:function(a){if(!(a[0]||a[1])){return}this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1])}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0){Draggables._lastScrollPointer[0]=0}if(Draggables._lastScrollPointer[1]<0){Draggables._lastScrollPointer[1]=0}this.draw(Draggables._lastScrollPointer)}if(this.options.change){this.options.change(this)}},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft}else{if(w.document.body){T=body.scrollTop;L=body.scrollLeft}}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight}else{if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight}else{W=body.offsetWidth;H=body.offsetHeight}}}return{top:T,left:L,width:W,height:H}}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(b,a){this.element=$(b);this.observer=a;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element)){this.observer(this.element)}}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(a){while(a.tagName.toUpperCase()!="BODY"){if(a.id&&Sortable.sortables[a.id]){return a}a=a.parentNode}},options:function(a){a=Sortable._findRootElement($(a));if(!a){return}return Sortable.sortables[a.id]},destroy:function(a){a=$(a);var b=Sortable.sortables[a.id];if(b){Draggables.removeObserver(b.element);b.droppables.each(function(c){Droppables.remove(c)});b.draggables.invoke("destroy");delete Sortable.sortables[b.element.id]}},create:function(c){c=$(c);var b=Object.extend({element:c,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:c,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(c);var a={revert:true,quiet:b.quiet,scroll:b.scroll,scrollSpeed:b.scrollSpeed,scrollSensitivity:b.scrollSensitivity,delay:b.delay,ghosting:b.ghosting,constraint:b.constraint,handle:b.handle};if(b.starteffect){a.starteffect=b.starteffect}if(b.reverteffect){a.reverteffect=b.reverteffect}else{if(b.ghosting){a.reverteffect=function(f){f.style.top=0;f.style.left=0}}}if(b.endeffect){a.endeffect=b.endeffect}if(b.zindex){a.zindex=b.zindex}var d={overlap:b.overlap,containment:b.containment,tree:b.tree,hoverclass:b.hoverclass,onHover:Sortable.onHover};var e={onHover:Sortable.onEmptyHover,overlap:b.overlap,containment:b.containment,hoverclass:b.hoverclass};Element.cleanWhitespace(c);b.draggables=[];b.droppables=[];if(b.dropOnEmpty||b.tree){Droppables.add(c,e);b.droppables.push(c)}(b.elements||this.findElements(c,b)||[]).each(function(h,f){var g=b.handles?$(b.handles[f]):(b.handle?$(h).select("."+b.handle)[0]:h);b.draggables.push(new Draggable(h,Object.extend(a,{handle:g})));Droppables.add(h,d);if(b.tree){h.treeNode=c}b.droppables.push(h)});if(b.tree){(Sortable.findTreeElements(c,b)||[]).each(function(f){Droppables.add(f,e);f.treeNode=c;b.droppables.push(f)})}this.sortables[c.identify()]=b;Draggables.addObserver(new SortableObserver(c,b.onUpdate))},findElements:function(b,a){return Element.findChildren(b,a.only,a.tree?true:false,a.tag)},findTreeElements:function(b,a){return Element.findChildren(b,a.only,a.tree?true:false,a.treeTag)},onHover:function(e,d,a){if(Element.isParent(d,e)){return}if(a>0.33&&a<0.66&&Sortable.options(d).tree){return}else{if(a>0.5){Sortable.mark(d,"before");if(d.previousSibling!=e){var b=e.parentNode;e.style.visibility="hidden";d.parentNode.insertBefore(e,d);if(d.parentNode!=b){Sortable.options(b).onChange(e)}Sortable.options(d.parentNode).onChange(e)}}else{Sortable.mark(d,"after");var c=d.nextSibling||null;if(c!=e){var b=e.parentNode;e.style.visibility="hidden";d.parentNode.insertBefore(e,c);if(d.parentNode!=b){Sortable.options(b).onChange(e)}Sortable.options(d.parentNode).onChange(e)}}}},onEmptyHover:function(e,g,h){var j=e.parentNode;var a=Sortable.options(g);if(!Element.isParent(g,e)){var f;var c=Sortable.findElements(g,{tag:a.tag,only:a.only});var b=null;if(c){var d=Element.offsetSize(g,a.overlap)*(1-h);for(f=0;f<c.length;f+=1){if(d-Element.offsetSize(c[f],a.overlap)>=0){d-=Element.offsetSize(c[f],a.overlap)}else{if(d-(Element.offsetSize(c[f],a.overlap)/2)>=0){b=f+1<c.length?c[f+1]:null;break}else{b=c[f];break}}}}g.insertBefore(e,b);Sortable.options(j).onChange(e);a.onChange(e)}},unmark:function(){if(Sortable._marker){Sortable._marker.hide()}},mark:function(b,a){var d=Sortable.options(b.parentNode);if(d&&!d.ghosting){return}if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker)}var c=b.cumulativeOffset();Sortable._marker.setStyle({left:c[0]+"px",top:c[1]+"px"});if(a=="after"){if(d.overlap=="horizontal"){Sortable._marker.setStyle({left:(c[0]+b.clientWidth)+"px"})}else{Sortable._marker.setStyle({top:(c[1]+b.clientHeight)+"px"})}}Sortable._marker.show()},_tree:function(e,b,f){var d=Sortable.findElements(e,b)||[];for(var c=0;c<d.length;++c){var a=d[c].id.match(b.format);if(!a){continue}var g={id:encodeURIComponent(a?a[1]:null),element:e,parent:f,children:[],position:f.children.length,container:$(d[c]).down(b.treeTag)};if(g.container){this._tree(g.container,b,g)}f.children.push(g)}return f},tree:function(d){d=$(d);var c=this.options(d);var b=Object.extend({tag:c.tag,treeTag:c.treeTag,only:c.only,name:d.id,format:c.format},arguments[1]||{});var a={id:null,parent:null,children:[],container:d,position:0};return Sortable._tree(d,b,a)},_constructIndex:function(b){var a="";do{if(b.id){a="["+b.position+"]"+a}}while((b=b.parent)!=null);return a},sequence:function(b){b=$(b);var a=Object.extend(this.options(b),arguments[1]||{});return $(this.findElements(b,a)||[]).map(function(c){return c.id.match(a.format)?c.id.match(a.format)[1]:""})},setSequence:function(b,c){b=$(b);var a=Object.extend(this.options(b),arguments[2]||{});var d={};this.findElements(b,a).each(function(e){if(e.id.match(a.format)){d[e.id.match(a.format)[1]]=[e,e.parentNode]}e.parentNode.removeChild(e)});c.each(function(e){var f=d[e];if(f){f[1].appendChild(f[0]);delete d[e]}})},serialize:function(c){c=$(c);var b=Object.extend(Sortable.options(c),arguments[1]||{});var a=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:c.id);if(b.tree){return Sortable.tree(c,arguments[1]).children.map(function(d){return[a+Sortable._constructIndex(d)+"[id]="+encodeURIComponent(d.id)].concat(d.children.map(arguments.callee))}).flatten().join("&")}else{return Sortable.sequence(c,arguments[1]).map(function(d){return a+"[]="+encodeURIComponent(d)}).join("&")}}};Element.isParent=function(b,a){if(!b.parentNode||b==a){return false}if(b.parentNode==a){return true}return Element.isParent(b.parentNode,a)};Element.findChildren=function(d,b,a,c){if(!d.hasChildNodes()){return null}c=c.toUpperCase();if(b){b=[b].flatten()}var e=[];$A(d.childNodes).each(function(g){if(g.tagName&&g.tagName.toUpperCase()==c&&(!b||(Element.classNames(g).detect(function(h){return b.include(h)})))){e.push(g)}if(a){var f=Element.findChildren(g,b,a,c);if(f){e.push(f)}}});return(e.length>0?e.flatten():[])};Element.offsetSize=function(a,b){return a["offset"+((b=="vertical"||b=="height")?"Height":"Width")]};Tapestry.Validator.pqmultiemail=function(b,a){b.addValidator(function(c){if(!Tapestry.Validator.pqmultiemail.validate(c.trim())){throw a}})};Tapestry.Validator.pqmultiemail.validate=function(a){if(a.length==0){return true}else{var b=a.split(new RegExp("[,;]","g"));for(i=0;i<b.length;i++){if(!Tapestry.Validator.pqemail.validate(b[i].trim())){return false}}return true}};var Cookies={create:function(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"},read:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null},remove:function(a){Cookies.create(a,"",-1)}};var Cookies2={create:function(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"},read:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null},remove:function(a){Cookies.create(a,"",-1)}};function checkTZCookie(){if(Cookies2.read("oneSearchTZ")==null){var a=new Date();Cookies2.create("oneSearchTZ",-a.getTimezoneOffset())}}checkTZCookie();function toggleDiv(b,d,a){var c=$(b);Effect.toggle(c,"blind",{duration:1});var g=$(a);if(g){var e=g.innerHTML;g.innerHTML=(e=="Show all"?"Show less":"Show all");var f=$(d);if(f){f.toggleClassName("indicator_menu_down");f.toggleClassName("indicator_menu_up")}}return false}function toggleDiv2(b,c,a,f){var d=$(f);if(d){var e=d.innerHTML;d.innerHTML=(e=="Show all"?"Show less":"Show all")}return toggleDiv(b,c,a)}function toggleStyle(c,a,b){$$(c).each(function(d){d.style.backgroundColor="#ffffff"});$(a).style.backgroundColor=b}String.prototype.trim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"")};function r(a){return function(){var b=[];for(var c=0;c<arguments.length;c++){b.push(arguments[c])}this.each(function(d){if(d&&(typeof d[a]=="function"||typeof d[a]=="object")){d[a].apply(d,b)}});return this}}function om(b,a){for(prop in b){if(b.hasOwnProperty(prop)){a[prop]=r(prop)}}}om(Element.Methods,Array.prototype);function DomObserver(){this.observe=function(a,b,c){if(b.indexOf(".")===0){this._add(a,b.substr(1),c,"classes")}else{if(b.indexOf("#")===0){this._add(a,b.substr(1),c,"ids")}else{this._add(a,b,c,"ids")}}};this._add=function(b,c,d,a){if(this[a][b]==undefined){this[a][b]={}}if(this[a][b][c]==undefined){this[a][b][c]=[]}this[a][b][c].push(d)};this.createObserver=function(a){this.classes[a]=[];this.ids[a]=[];document.observe(a,function(g,f){if(g.button==0){element=g.element();while(element){var d=$w(element.className);for(var c=0;c<d.length;c++){if(this.classes[a][d[c]]&&this.classes[a][d[c]].length>0){var b=this.classes[a][d[c]];for(var h=0;h<b.length;h++){this.classes[a][d[c]][h](g,element)}Event.stop(g);return}}if(element.parentNode){element=element.parentNode}else{break}}}}.bind(this))};this.classes={};this.ids={};["click","keypress","keyup","keydown"].each(function(a){this.createObserver(a)}.bind(this))}document.observer=new DomObserver();function callWebTrendsWithRetry(c,a,b){if(window.dcsMultiTrack){dcsMultiTrack("WT.ti",c,a,b,"DCS.dcsuri","/"+b,"WT.es","search.proquest.com/"+a+"/"+b,"WT.dl","30")}else{setTimeout(function(){dcsMultiTrack("WT.ti",c,a,b,"DCS.dcsuri","/"+b,"WT.es","search.proquest.com/"+a+"/"+b,"WT.dl","30")},2000)}}function callClickWebTrendsWithRetry(a){a.push("DCSext.sessionId");a.push(getCookie("JSESSIONID"));a.push("DCSext.appUIVersion");a.push("PDO");if(window.WebTrends&&WebTrends.multiTrack){WebTrends.multiTrack({argsa:a,callback:function(b){},delayTime:150})}else{setTimeout(function(){if(window.WebTrends&&WebTrends.multiTrack){WebTrends.multiTrack({argsa:a,callback:function(b){},delayTime:150})}else{}},2000)}}function getWtAgrsAndCallWebTrends(c){if("wtTrack" in window&&wtTrack!=undefined&&wtTrack.length>0){if(wtTrack=="{}"){return}var e=JSON.parse(wtTrack);for(var d=0;d<e.wt_page.wt_entries.length;d++){var f=e.wt_page.wt_entries[d];var b=[];for(parm in f.wt_multitrack_arguments){b.push('"'+parm+'"');b.push('"'+f.wt_multitrack_arguments[parm]+'"')}if(f.wt_css_locator=="#"+c){var a=b.join(",");var h=a.substring(1,(a.length-1));var g=h.split('","');callClickWebTrendsWithRetry(g)}}}}function getCookie(a){var b=document.cookie.split(a+"=");if(b.length==2){return b.pop().split(";").shift()}}document.observe("dom:loaded",function(){function d(q){q.observe("click",function(u){var t=u.findElement("[data-wt]");var s=t.getAttribute("data-wt");if(s){var w=s.substring(1,s.length-1);var v=w.split('","');callClickWebTrendsWithRetry(v)}})}function c(q){q.observe("keydown",function(u){if(u.keyCode==Event.KEY_RETURN||u.which==Event.KEY_RETURN){var t=u.findElement("[data-wt]");var s=t.getAttribute("data-wt");if(s){var w=s.substring(1,s.length-1);var v=w.split('","');callClickWebTrendsWithRetry(v)}}})}function l(t,q){for(var s=0;s<t.length;++s){t[s].setAttribute("data-wt",q.join(","));d(t[s])}}function g(u,q){var t="enter-press-event:";for(var s=0;s<u.length;++s){u[s].setAttribute("data-wt",q.join(","));c(u[s])}}function o(q,s,w,A){var y=false;var u=[];var B=[];var t="enter-press-event:";for(var v=0,z=q.length;v<z;v++){if(q[v].wt_css_locator.indexOf(t)>-1){var x=$$(q[v].wt_css_locator.substr(t.length,q[v].wt_css_locator.length-1).replace(/&gt;/g,">"));if(x.length==0){y=true;u.push(q[v]);B.push(s[v])}else{g(x,s[v])}}else{var x=$$(q[v].wt_css_locator.replace(/&gt;/g,">"));if(x.length==0){y=true;u.push(q[v]);B.push(s[v])}else{l(x,s[v])}}}if(A>0&&y){setTimeout(function(){o(u,B,w,A-1)},w)}}if("wtTrack" in window&&wtTrack!=undefined&&wtTrack.length>0){if(wtTrack=="{}"){return}var p=JSON.parse(wtTrack);var a=[];var b=[];var f="enter-press-event:";for(var h=0;h<p.wt_page.wt_entries.length;h++){var m=p.wt_page.wt_entries[h];var n=[];for(parm in m.wt_multitrack_arguments){n.push('"'+parm+'"');n.push('"'+m.wt_multitrack_arguments[parm]+'"')}if(m.wt_css_locator.indexOf(f)>-1){var k=$$(m.wt_css_locator.substr(f.length,m.wt_css_locator.length-1).replace(/&gt;/g,">"));if(k.length==0){a.push(m);b.push(n)}else{g(k,n)}}else{var k=$$(m.wt_css_locator.replace(/&gt;/g,">"));if(k.length==0){a.push(m);b.push(n)}else{l(k,n)}}}var e=1000;var j=1000;retries=5;setTimeout(function(){o(a,b,j,retries)},e)}});var pqCoreUtil={makeUrlRelative:function(a){var b=/^https?:\/\/[^\/]+\//i;return a.replace(b,"/")}};Tapestry.Initializer.autocompleter=function(a){$T(a.elementId).autocompleter=new Ajax.Autocompleter(a.elementId,a.menuId,a.url,a.config)};function submitOnEnter(h,g,b,c,f,e){if(b&&g){var d=$(g);if(d){d.observe("keydown",submitOnEnterFormKeyDown.bindAsEventListener(this,h,g,b,c,f,e))}}var a=$(h);if(a){a.observe("click",submitOnEnterClick.bindAsEventListener(this,h,g,b,c,f,e))}}function submitOnEnterFormKeyDown(b,c,h,a,j,f,d){var k,g;element=b.findElement();if(element&&element.form&&element.form.id==h){submitOnEnterKeyDown(b,c,h,a,j,f,d)}}function submitOnEnterKeyDown(e,submitLinkId,formId,submitOnEnter,asAjax,onClick,preSubmit){if(e.keyCode==13&&$(submitLinkId).readAttribute("disabled")!="disabled"&&(!preSubmit||preSubmit.length==0||eval(preSubmit))){if(!Ajax||!Ajax.Autocompleter||!Ajax.Autocompleter.blockSumbitOnEnter){$(formId).setSubmittingElement(submitLinkId);setTimeout(function(){if(asAjax){$(formId).fire("pq:time");$(formId).fire(Tapestry.FORM_PROCESS_SUBMIT_EVENT)}else{$(formId).fire("pq:time");$(formId).submit()}if(onClick&&onClick.length>0){eval(onClick)}},300)}Event.stop(e)}}function submitOnEnterClick(l,submitLinkId,formId,submitOnEnter,asAjax,onClick,preSubmit){if($(submitLinkId).readAttribute("disabled")!="disabled"&&(!preSubmit||preSubmit.length==0||eval(preSubmit))){$(formId).setSubmittingElement(submitLinkId);if(asAjax){$(formId).fire("pq:time");$(formId).fire(Tapestry.FORM_PROCESS_SUBMIT_EVENT)}else{$(formId).fire("pq:time");$(formId).submit()}Event.stop(l);if(onClick&&onClick.length>0){eval(onClick)}}}Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(c,d,b,a){this.elementId=c;a.disableUrl=pqCoreUtil.makeUrlRelative(a.disableUrl);this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.onShow=this.onShow.bind(this);this.options.onHide=this.onHide.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=pqCoreUtil.makeUrlRelative(b);this.suggestionCache={};this.originalTerm="";Ajax.Autocompleter[c]=true;Ajax.Autocompleter.blockSumbitOnEnter=false;Ajax.Autocompleter.disabled=(this.options.disabled)?true:false},onShow:function(a,b){if(this.closed==true||this.active==false){this.hide();return}if($("suggestionBoxNote")!=undefined){$("suggestionBoxNote").update(this.options.suggestionBoxNote);$("suggestionBoxNote").innerHTML}b.style.left=this.options.leftOffset+"px";if(!b.style.position||b.style.position=="absolute"){b.style.position="absolute";Element.clonePosition(b,a,{setHeight:false,offsetTop:a.offsetHeight})}Effect.Appear(b,{duration:0.15});b.style.left=this.options.leftOffset+"px";if(!this.options.autoExecute){Ajax.Autocompleter.blockSumbitOnEnter=true}this.element.fire("autocomplete:open")},onHide:function(a,b){if($("disableAutoCompleteNote")!=undefined){$("disableAutoCompleteNote").update("");$("disableAutoCompleteNote").innerHTML}if($("suggestionBoxNote")!=undefined){$("suggestionBoxNote").update("");$("suggestionBoxNote").innerHTML}new Effect.Fade(b,{duration:0.15});if(!this.options.autoExecute){window.setTimeout(function(){Ajax.Autocompleter.blockSumbitOnEnter=false},1000)}this.element.fire("autocomplete:close")},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)},onKeyPress:function($super,a){if(Ajax.Autocompleter.disabled){return}if(!Ajax.Autocompleter[this.elementId]){return}if(this.closed&&this.getToken().length==0){this.closed=false}if(a.keyCode==Event.KEY_ESC&&this.active==false){return}if(this.active){switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:if(this.index==this.entryCount-1){if(a.keyCode==Event.KEY_RETURN){this.disableAutoComplete()}Event.stop(a)}if(!this.options.autoExecute){Event.stop(a)}if(this.observer){clearTimeout(this.observer)}this.hide();this.active=false;return;case Event.KEY_ESC:this.hide();this.active=false;this.element.value=this.originalTerm;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();this.pasteCurrent();return;case Event.KEY_DOWN:this.markNext();this.render();this.pasteCurrent();if(this.index==this.entryCount-1&&$("disableAutoCompleteNote")!=undefined){$("disableAutoCompleteNote").update(this.options.disableAutoCompleteNote);$("disableAutoCompleteNote").innerHTML}return}}else{if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||a.keyCode==0){if(a.keyCode==Event.KEY_RETURN){if(this.observer){clearTimeout(this.observer)}this.closed=true;return}}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},markPrevious:function(){if(this.index>-1){this.index--}this.scrollToSelection(this.getEntry(this.index))},markNext:function(){if(this.index<this.entryCount-1){this.index++}this.scrollToSelection(this.getEntry(this.index))},scrollToSelection:function(c){if(c!=null){var b=c.viewportOffset().top;var d=b+c.getHeight();if(d>document.viewport.getHeight()){c.scrollIntoView(false)}else{if(b<0){c.scrollIntoView(true)}}}else{var a=$(this.elementId);if(a.viewportOffset().top<0){a.scrollIntoView(true)}}},pasteCurrent:function(){this.element.value="";if(this.index==-1||this.index==this.entryCount-1){this.element.value=this.originalTerm}else{var a=this.getCurrentEntry();if(a!=null){this.updateElement(a)}}},updateChoices:function(c){this.suggestionCache[this.originalTerm]=c;if(!this.changed&&this.hasFocus){this.update.innerHTML=c;Element.cleanWhitespace(this.update);if(this.update.down()){Element.cleanWhitespace(this.update.down())}if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else{this.entryCount=0}this.stopIndicator();this.index=-1;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(!this.closed&&this.getToken().length>=this.options.minChars){this.active=true;this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},selectEntry:function(){this.active=false;var a=this.getCurrentEntry();if(a!=null){this.updateElement(a);if(this.options.formId&&this.options.autoExecute){$(this.options.formId).submit()}}},getCurrentEntry:function(){if(this.index==this.entryCount-1){this.disableAutoComplete();return null}else{return this.getEntry(this.index)}},disableAutoComplete:function(){this.closed=true;this.hide();this.element.value=this.originalTerm;this.element.focus();new Ajax.Request(this.options.disableUrl);pushEventToGA("autoCompleteClickOff"+this.options.pageName);Ajax.Autocompleter.disabled=true},updateElement:function(c){if(this.options.updateElement){this.options.updateElement(c);return}var b="";if(this.options.select){var a=$(c).select("."+this.options.select)||[];if(a.length>0){b=Element.collectTextNodes(a[0],this.options.select)}}else{b=Element.collectTextNodesIgnoreClass(c,"informal")}this.element.value=b;this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,c)}},getUpdatedChoices:function(){this.originalTerm=this.getToken();if(this.suggestionCache[this.originalTerm]){this.updateChoices(this.suggestionCache[this.originalTerm]);return}this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}if(this.options.autocompleteField){this.options.parameters+="&field="+this.options.autocompleteField}else{if(Ajax.Autocompleter[this.elementId]){this.options.parameters+="&field="+Ajax.Autocompleter[this.elementId]}}new Ajax.Request(this.url,this.options)}});var ClickOnce=Class.create();var alreadyClickedOnce=false;ClickOnce.prototype={initialize:function(a){Event.observe($(a),"click",this.doClickOnce.bindAsEventListener(this))},doClickOnce:function(a){if(alreadyClickedOnce){a.stop()}alreadyClickedOnce=true},resetClicked:function(){alreadyClickedOnce=false}};var EndSessionWarning=Class.create({initialize:function(a){this.timeout=a.timeout;this.warntime=a.warntime;this.pingURL=pqCoreUtil.makeUrlRelative(a.pingURL);this.endSessionWarningCarryOnId=a.endSessionWarningCarryOnId;this.endSessionWarningOverlayId=a.endSessionWarningOverlayId;this.secondsText=a.secondsText;this.minutesText=a.minutesText;this.hoursText=a.hoursText;this.sessonTimer=new PeriodicalExecuter(this.warn.bind(this),this.timeout-this.warntime-5);$(this.endSessionWarningCarryOnId).observe("click",this.carryOn.bindAsEventListener(this));$("endSessionConfirmCancel").observe("click",this.cancelEnd.bindAsEventListener(this));this.createCookie()},warn:function(g){g.stop();var f=true;var c=Cookies.read("osTimestamp");if(c){var e=new Number(c);var a=new Date().getTime()/1000;var d=a-e;var b=this.timeout-this.warntime-5;if(d<b){f=false;this.sessionTimer=new PeriodicalExecuter(this.warn.bind(this),b-d)}}if(f){this.counter=this.warntime;this.warnSpan=$("warnTime");this.warnSpan.update(this.formatOutput());this.warningTimer=new PeriodicalExecuter(this.countDown.bind(this),1);Overlay.box.showOverlay(this.endSessionWarningOverlayId)}},unwarn:function(){this.warningTimer.stop();Cookies.remove("AppVersion");Overlay.box.hideOverlay()},carryOn:function(a){a.stop();this.unwarn();new Ajax.Request(this.pingURL);this.createCookie();this.resetWarning()},resetWarning:function(){this.sessonTimer=new PeriodicalExecuter(this.warn.bind(this),this.timeout-this.warntime-5)},cancelEnd:function(a){a.stop();Overlay.box.hideOverlay()},countDown:function(){this.counter--;this.warnSpan.update(this.formatOutput());if(this.counter==0){if(window.wind!=undefined){wind.close();wind=null}this.unwarn()}},formatOutput:function(){var a,c,d,b="";d=this.counter%60;c=Math.floor(this.counter/60)%60;a=Math.floor(this.counter/3600);if(a>0){b+=a+" "+this.hoursText}if(c>0){if(b!=""){b+=" "}b+=c+" "+this.minutesText}if(b!=""){b+=" "}b+=d+" "+this.secondsText;return b},createCookie:function(){Cookies.create("osTimestamp",new Date().getTime()/1000)}});Tapestry.Initializer.endSessionWarning=function(a){new EndSessionWarning(a)};Ajax.Responders.register({onComplete:function(c,b,a){if(c.transport.responseText=="state:sessionEnded"){window.location.reload()}}});var SearchTermsDynamicRows=Class.create({initialize:function(a){this.addText=a.addTriggerText;this.removeText=a.removeTriggerText;this.minRows=a.minRows;this.maxRows=a.maxRows;this.rowIndex=a.rowIndex;this.updateTriggers()},getRowFragmentId:function(a){return"row"+a+"frag"},addRowClick:function(a){a.stop();var b=this.getRowFragmentId(this.rowIndex);this.resetRow(b);$(b).fire(Tapestry.CHANGE_VISIBILITY_EVENT,{visible:true},true);this.focusText.bind(this,b).delay(1.2);this.rowIndex++;this.updateTriggers()},removeRowClick:function(a){a.stop();this.rowIndex--;var b=this.getRowFragmentId(this.rowIndex);$(b).fire(Tapestry.CHANGE_VISIBILITY_EVENT,{visible:false},true);this.updateTriggers();getWtAgrsAndCallWebTrends("removeRowLink")},focusText:function(a){var a=$(a).select("textarea").each(function(c){if(c&&c.up("div").visible()&&c.id.indexOf("Right")==-1){try{c.focus();document.fire("pq:focusQueryTerm",c.id);throw $break}catch(b){}}})},updateTriggers:function(){if(this.rowIndex>this.minRows){this.enableRemoveTrigger()}else{if(this.rowIndex<=this.minRows){this.disableRemoveTrigger()}}if(this.rowIndex<this.maxRows){this.enableAddTrigger()}else{if(this.rowIndex>=this.maxRows){this.disableAddTrigger()}}},enableAddTrigger:function(){if(this.addTrigger==null){this.addTrigger=new Element("a",{href:"#",id:"addRowLink"}).update(this.addText);this.addTrigger.insert({top:new Element("span",{"class":"uxf-icon uxf-plus-circle"})});$("addSTRow").insert({bottom:this.addTrigger});this.addTrigger.observe("click",this.addRowClick.bindAsEventListener(this))}},disableAddTrigger:function(){if(this.addTrigger!=null){this.addTrigger=null;$("addSTRow").update()}},enableRemoveTrigger:function(){if(this.removeTrigger==null){this.removeTrigger=new Element("a",{href:"#",id:"removeRowLink"}).update(this.removeText);this.removeTrigger.insert({top:new Element("span",{"class":"uxf-icon uxf-minus-circle"})});$("removeSTRow").insert({bottom:this.removeTrigger});this.removeTrigger.observe("click",this.removeRowClick.bindAsEventListener(this))}},disableRemoveTrigger:function(){if(this.removeTrigger!=null){this.removeTrigger=null;$("removeSTRow").update()}},resetRow:function(a){$(a).select("textarea").each(function(b){b.value=""})}});Tapestry.Initializer.searchTermsDynamicRows=function(a){new SearchTermsDynamicRows(a)};var SearchTermFormRowFieldSelectListener=Class.create({initialize:function(a){this.selectId=a.selectId;this.textFieldIds=a.textFieldIds;this.autocompleteFields=a.autocompleteFields;$(this.selectId).observe("change",this.handleSelectChange.bindAsEventListener(this))},handleSelectChange:function(){if(Ajax.Autocompleter){var a=$F(this.selectId);var b=null;this.autocompleteFields.each(function(c){b|=(a==c)});this.textFieldIds.each(function(c){Ajax.Autocompleter[c]=(b)?a:null})}}});Tapestry.Initializer.searchTermFormRow=function(b){var a=new SearchTermFormRowFieldSelectListener(b)};var DateRangeTypeSelector=Class.create({initialize:function(a){this.selectId=a.selectId;this.selectDropDown=$(this.selectId);this.startingLabelId=a.startingLabelId;this.endingLabelId=a.endingLabelId;this.dateId1=a.dateId1;this.date1=$(this.dateId1);this.dateId2=a.dateId2;this.date2=$(this.dateId2);this.onDateMessageId=a.onDateMessageId;this.beforeDateMessageId=a.beforeDateMessageId;this.afterDateMessageId=a.afterDateMessageId;this.dateRangeMessageId=a.dateRangeMessageId;this.selectDropDown.observe("change",this.handleChange.bindAsEventListener(this));this.handleChange.bind(this).defer()},handleChange:function(){var a=this.selectDropDown.value;switch(a){case"ON":this.showDateField1(true);this.showDateField2(false);this.showMessage(null);this.showMessage(this.onDateMessageId);this.showStartEndLabels(false);break;case"BEFORE":this.showDateField1(true);this.showDateField2(false);this.showMessage(this.beforeDateMessageId);this.showStartEndLabels(false);break;case"AFTER":this.showDateField1(true);this.showDateField2(false);this.showMessage(this.afterDateMessageId);this.showStartEndLabels(false);break;case"RANGE":this.showDateField1(true);this.showDateField2(true);this.showMessage(this.dateRangeMessageId);this.showStartEndLabels(true);break;default:this.showDateField1(false);this.showDateField2(false);this.showMessage(null);this.showStartEndLabels(false)}},showDateField1:function(a){if(a){this.date1.show()}else{this.date1.hide()}},showDateField2:function(a){if(a){this.date2.show()}else{this.date2.hide()}},showMessage:function(a){if($(this.onDateMessageId)!=null){$(this.onDateMessageId).hide()}if($(this.beforeDateMessageId)!=null){$(this.beforeDateMessageId).hide()}if($(this.afterDateMessageId)!=null){$(this.afterDateMessageId).hide()}if($(this.dateRangeMessageId)!=null){$(this.dateRangeMessageId).hide()}if($(a)!=null){$(a).show()}},showStartEndLabels:function(a){if(a){$(this.startingLabelId).show();$(this.endingLabelId).show()}else{$(this.startingLabelId).hide();$(this.endingLabelId).hide()}}});Tapestry.Initializer.dateRangeTypeSelector=function(a){var b=new DateRangeTypeSelector(a)};var MarkedListCheckbox=Class.create({initialize:function(a){this.checkboxId=a.checkboxId;this.checkbox=$(this.checkboxId);markedListCheckboxElements.push(this.checkbox);this.markURL=pqCoreUtil.makeUrlRelative(a.markURL);this.itemIds=a.itemIds;this.formats=a.formats;this.markAll=a.markAll;this.marked=a.marked;this.checkbox.checked=this.marked;if(this.markAll){this.checkAllSelected()}this.checkbox.observe("click",this.markClick.bindAsEventListener(this))},markClick:function(a){new Ajax.Request(this.markURL+"/"+this.checkbox.checked,{method:"post",parameters:{itemIds:Object.toJSON(this.itemIds),formats:Object.toJSON(this.formats)},onFailure:function(b){alert("Error communicating with the server")},onException:function(c,b){alert("Exception communicating with the server")},onSuccess:function(e){var c=e.responseText.split(",");var g=c[1],d=c[2],b=c[3];if(b=="success"){var f=a.target.id;pushDataToGA({resultRank:f.substring(4,5)});this.markedListSuccess(g,d)}else{if(b=="successAll"){this.markedListAllSuccess(g,d)}else{if(b=="reachedLimit"){this.checkbox.checked=false;this.notifyMarkedListLimitReached()}}}document.fire("pq:selectedItemsUpdate",d)}.bind(this)})},markedListSuccess:function(d,b){var a=this.checkboxId.replace("mlcb","mlditem");var c=this.checkboxId.replace("mlcb","mldcopy");$(a).toggleClassName("item_selected");$(c).toggleClassName("copy_selected");$$("span.markedTotal").each(function(e){e.innerHTML=b});this.checkAllSelected()},markedListAllSuccess:function(c,a){var b=(c=="add");$$("div.item").invoke(c+"ClassName","item_selected");$$("div.results_list_copy").invoke(c+"ClassName","copy_selected");$$("input.marked_list_checkbox").each(function(d){d.checked=b});$$("span.markedTotal").each(function(d){d.innerHTML=a});this.checkAllSelected()},notifyMarkedListLimitReached:function(){Overlay.box.showOverlay("reachLimit_warning")},checkAllSelected:function(){var a=$("mlcbAll");if(a!=null){var e=[];this.allSelected=true;for(var b=0;b<markedListCheckboxElements.length;b++){var c=markedListCheckboxElements[b];if(c.id.search(/^mlcbAll/i)==-1){var d=c.checked;this.allSelected=this.allSelected&&d}else{e.push(c)}}for(var b=0;b<e.length;b++){e[b].checked=this.allSelected}}}});var markedListCheckboxElements=[];Tapestry.Initializer.markedListCheckbox=function(a){new MarkedListCheckbox(a)};var HiddenHitMarkerSwitch=Class.create({initialize:function(a){this.toggleId=a.toggleId;this.toggleLink=$(this.toggleId);this.hitMarkerText=a.hitMarkerText;this.markerOn=a.markerOn;this.markerOnText=a.markerOnText;this.markerOffText=a.markerOffText;this.setupHitMarkers();this.toggleLink.observe("click",this.markClick.bindAsEventListener(this))},markClick:function(a){Event.stop(a);this.markerOn=!this.markerOn;this.setupHitMarkers()},setupHitMarkers:function(){this.toggleLink.update(this.markerOn?this.markerOffText:this.markerOnText);if(this.markerOn){this.addHitMarkers()}else{this.removeHitMarkers()}},addHitMarkers:function(){var a=$$("span.hit");a.each(function(c){var b=new Element("span",{"class":"hiddenText"}).update(this.hitMarkerText);Element.insert(c,{top:b})},this)},removeHitMarkers:function(){if(Prototype.BrowserFeatures.SelectorsAPI||Prototype.BrowserFeatures.XPath){var b=$$("span.hit span.hiddenText");b.each(function(j){Element.remove(j)})}else{var f=document.getElementsByTagName("span"),a=/\bhit\b/,g=/\bhiddenText\b/,e=[],d,c,h,k;for(d=f.length;h=f[--d];){if(a.test(h.className)){k=h.getElementsByTagName("span");for(c=k.length;h=k[--c];){if(g.test(h.className)){h.parentNode.removeChild(h)}}}}}}});Tapestry.Initializer.hiddenHitMarkerSwitch=function(a){new HiddenHitMarkerSwitch(a)};var HitNavigationSwitch=Class.create({initialize:function(a){this.field=a.field;this.fieldDiv=$(a.fieldDiv);this.switchLink=$(a.clientId);this.switchLink.observe("click",this.switchClick.bindAsEventListener(this));this.switchLink.observe("hitnav:refresh",this.refreshHitNav.bindAsEventListener(this));this.navEnabled=a.navEnabled;this.enableText=a.enableLinkText;this.disableText=a.disableLinkText;this.prevLinkTitle=a.prevLinkTitle;this.prevAltText=a.prevAltText;this.prevImg=a.imagesPath+"/prevhit.gif";this.nextLinkTitle=a.nextLinkTitle;this.nextAltText=a.nextAltText;this.nextImg=a.imagesPath+"/nexthit.gif";if(!this.hitsAvailable()){this.switchLink.hide();$(this.field+"_firsthit").hide()}else{this.switchLink.show()}if(this.navEnabled){this.showNavigationLinks()}},refreshHitNav:function(a){this.refresh();a.stop()},refresh:function(){if(!this.hitsAvailable()){this.switchLink.hide();$(this.field+"_firsthit").hide();this.navEnabled=false}else{this.switchLink.show()}if(this.navEnabled){this.showNavigationLinks();pushEventToGA("hitHighNavigationOn");this.switchLink.update(this.disableText)}else{this.hideNavigationLinks();pushEventToGA("hitHighNavigationOff");this.switchLink.update(this.enableText)}},hitsAvailable:function(){if(this.fieldDiv!=null&&this.fieldDiv.select(".hit").size()>1){return true}else{return false}},showNavigationLinks:function(){$(this.field+"_firsthit").show();$(this.field+"_firsthit").observe("click",this.firstHit.bindAsEventListener(this));var a=this.fieldDiv.select(".hit");a.each(function(e,d){if(d>0){var c=new Element("a",{href:"#"+this.getAnchor(d-1),name:this.getAnchor(d),title:this.prevLinkTitle,"class":"prevHitLink bullets_base_sprite bullet_arrow_left",id:"prev"+this.getAnchor(d)});c.observe("click",this.previousClick.bindAsEventListener(this));Element.insert(e,{before:c})}if(d<(a.size()-1)){var b;if(d==0){b=new Element("a",{href:"#"+this.getAnchor(d+1),name:this.getAnchor(d),title:this.nextLinkTitle,"class":"nextHitLink bullets_base_sprite bullet_arrow_right",id:"next"+this.getAnchor(d)})}else{b=new Element("a",{href:"#"+this.getAnchor(d+1),title:this.nextLinkTitle,"class":"nextHitLink bullets_base_sprite bullet_arrow_right",id:"next"+this.getAnchor(d)})}b.observe("click",this.nextClick.bindAsEventListener(this));Element.insert(e,{after:b})}}.bind(this))},hideNavigationLinks:function(){$(this.field+"_firsthit").hide();this.fieldDiv.select(".prevHitLink").invoke("remove");this.fieldDiv.select(".nextHitLink").invoke("remove")},getAnchor:function(a){return(this.field+"hit_"+a)},switchClick:function(a){this.navEnabled=!this.navEnabled;this.refresh();a.stop()},previousClick:function(b){var a=Event.findElement(b,"a");var e=a.id;var c=Number(e.split("_")[1])-1;var d;if(c==0){d="next"+this.getAnchor(c)}else{d="prev"+this.getAnchor(c)}this.goToElement(d);b.stop()},nextClick:function(b){var a=Event.findElement(b,"a");var d=a.id;var c=Number(d.split("_")[1]);this.goToElement("prev"+this.getAnchor(c+1));b.stop()},firstHit:function(a){this.goToElement("next"+this.getAnchor(0));a.stop()},goToElement:function(a){var b=$(a);if(b){Element.scrollTo(b)}}});Tapestry.Initializer.hitNavigationSwitch=function(a){new HitNavigationSwitch(a)};var ResultsFilter=Class.create({initialize:function(a){this.filterHeader=$(a.filterHeaderId);this.filterDiv=$(a.filterDivId);this.titleExpand=a.titleExpand;this.titleContract=a.titleContract;this.filterHeader.observe("click",this.toggleFilter.bindAsEventListener(this));this.hiddenSelectedFilterId=a.hiddenSelectedFilterId;if(a.immediateExpand){this.toggleFilter()}setFocusToSelectedFilter(this.hiddenSelectedFilterId)},toggleFilter:function(c){if(c){c.stop()}var b=this.filterHeader;var a=function(){b.toggleClassName("expanded");if(b.hasClassName("expanded")){b.title=this.titleContract}else{b.title=this.titleExpand}};Effect.toggle(this.filterDiv,"blind",{duration:0.5,afterFinish:a.bind(this)})}});Tapestry.Initializer.resultsFilter=function(a){new ResultsFilter(a)};function handleCheckboxClick(d,f){var a=f?"included":"excluded";var c=f?"excluded":"included";var e=d.up("tr.filter_more_row");var b=$(c+d.identify().substr(8));if(!(Prototype.Browser.IE&&(parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))<=7))){if(d.checked){b.checked=false;e.removeClassName(c);e.addClassName(a)}else{e.removeClassName(a)}}}function resetCheckboxClicks(a){var d=a.next("div");if(d){var c=d.down("div.filter_more_overlay");if(c){var b=c.down("form");if(b){b.select("div.filter_more_row").each(function(e){e.className="filter_more_row"});b.select("input").each(function(e){e.checked=false})}}}}function setFocusToSelectedFilter(a){if(document.getElementById(a)){document.getElementById(a).focus()}}if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){if(hasStorageEnabled){idToFocus=JSON.parse(localStorage.getItem("idToFocus"));if(idToFocus!=undefined&&document.getElementById(idToFocus)!=undefined){document.getElementById(idToFocus).focus()}localStorage.removeItem("idToFocus")}},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(hasStorageEnabled){idToFocus=JSON.parse(localStorage.getItem("idToFocus"));if(idToFocus!=undefined&&document.getElementById(idToFocus)!=undefined){document.getElementById(idToFocus).focus()}localStorage.removeItem("idToFocus")}})}}var hasStorageEnabled=(function(){try{var b=document.title;localStorage.setItem("title",b);var c=(localStorage.getItem("title")==b);localStorage.removeItem("title");return c}catch(a){return false}}());var DateRangeFilter=Class.create({initialize:function(a){this.filterHeader=$("dateFilter-header");this.filterDiv=$("dateFilter-div");this.titleExpand=a.titleExpand;this.titleContract=a.titleContract;this.filterHeader.observe("click",this.toggleFilter.bindAsEventListener(this));$$("#filterByRange")[0].observe("click",this.filterRange.bindAsEventListener(this));this.grouping=a.grouping;this.filterUrl=new String(pqCoreUtil.makeUrlRelative(a.filterUrl));this.filterNames=a.filterNames;$("dateFilter-graph-ux").select(".count").each(function(c,b){if(this.filterNames[b]!=""){c.observe("click",this.barClick.bindAsEventListener(this,b))}},this);this.trackDiv=$("dateFilter-track");this.trackDiv.setStyle({width:a.trackWidth+"px",left:a.trackOffset+"px"});this.handleDelay=a.handleDelay;if(this.grouping=="daynav"){this.sliderStart=this.getNotNullValue(0,a.numBars);this.sliderEnd=this.getNotNullValue(1,a.numBars)}else{this.sliderStart=0;this.sliderEnd=a.numBars}this.slider=new Control.Slider(["handle1","handle2"],this.trackDiv,{range:$R(0,a.numBars),values:$R(0,a.numBars),sliderValue:[this.sliderStart,this.sliderEnd],restricted:true,onChange:function(c){if(c[0]==c[1]){this.slider.setValue(c[1]+1,1)}else{if(this.rangeTimer){this.rangeTimer.stop()}var b="";$("handle1").title=this.getDisplay(c[0]);$("handle2").title=this.getDisplay(c[1]-1);for(i=c[0];i<c[1];i++){if(this.filterNames[i]!=""){b+="/"+this.filterNames[i]}}if(b!=""){this.filterRangeUrl=this.filterUrl.replace(":filter/",":filterrange/").replace("groupName",b.substring(1))}}}.bind(this),onSlide:function(b){$("filter_start").update(this.getDisplay(b[0]));$("filter_end").update(this.getDisplay(b[1]-1));if(this.rangeTimer){this.rangeTimer.stop()}}.bind(this)});$("handle1").title=this.getDisplay(this.sliderStart);$("handle2").title=this.getDisplay(this.sliderEnd-1);$("filter_start").update(this.getDisplay(this.sliderStart));$("filter_end").update(this.getDisplay(this.sliderEnd-1))},toggleFilter:function(c){c.stop();var b=this.filterHeader;var a=function(){b.toggleClassName("expanded");if(b.hasClassName("expanded")){b.title=this.titleContract}else{b.title=this.titleExpand}};Effect.toggle(this.filterDiv,"blind",{duration:0.5,afterFinish:a.bind(this)})},barClick:function(c,b){$("spinDiv").style.display="";var a=this.filterUrl.replace("groupName",this.filterNames[b]);document.location=pqCoreUtil.makeUrlRelative(a)},filterRange:function(a){if(this.rangeTimer){this.rangeTimer.stop()}if(this.filterRangeUrl!=undefined){$("spinDiv").style.display="";document.location=pqCoreUtil.makeUrlRelative(this.filterRangeUrl)}},getDisplay:function(a){var b=$("bar_"+a).title;var c=b.indexOf("(");return b.substring(0,c)},getNotNullValue:function(b,a){if(b==0){for(i=0;i<a;i++){if(this.filterNames[i]!=""){return i}}}else{for(i=a-1;i>=0;i--){if(this.filterNames[i]!=""){return i+1}}}}});Tapestry.Initializer.dateRangeFilter=function(a){new DateRangeFilter(a)};var ShowHideFiltersSwitcher=Class.create({initialize:function(){this.hideFilteredBy=$("hideFilteredBy");this.showFilteredBy=$("showFilteredBy");if(this.hideFilteredBy&&this.showFilteredBy){this.hideFilteredBy.observe("click",this.toggle.bindAsEventListener(this));this.showFilteredBy.observe("click",this.toggle.bindAsEventListener(this))}},toggle:function(a){a.stop();this.hideFilteredBy.toggle();this.showFilteredBy.toggle();Effect.toggle("filteredBy","blind",{duration:0.5});return false}});Tapestry.Initializer.showHideFiltersSwitcher=function(a){new ShowHideFiltersSwitcher(a)};Element.addMethods({collectTextNodes:function(a){return $A($(a).childNodes).collect(function(b){return(b.nodeType==3?b.nodeValue:(b.hasChildNodes()?Element.collectTextNodes(b):""))}).flatten().join("")},removeClassNames:function(a,b){if(!(a=$(a))){return}b.each(function(c){a.removeClassName(c)});return a}});var Comparator={compareFunction:function(a){switch(true){case a.include("integer"):return Comparator.complexCompare(function(b){return parseFloat(unformat(b))});case a.include("date"):return Comparator.complexCompare(Date.parse);case a.include("float"):return Comparator.complexCompare(function(b){return parseFloat(b.replace(/^.*?([\d\.]+).*$/,"$1"))});default:return Comparator.complexCompare(function(b){return b.toLowerCase()})}},simpleCompare:function(d,c){return d<c?-1:d==c?0:1},complexCompare:function(a){return function(d,c){return Comparator.simpleCompare(a(d),a(c))}}};Object.extend(Array.prototype,{sortByColumnHead:function(c,b,a){b=b.bind(a);return this.map(function(e,d){return{value:e,criteria:b(e,d)}}).sort(function(g,f){var e=g.criteria,d=f.criteria;sortFn=Comparator.compareFunction(c);return sortFn(e,d)}).pluck("value")}});var TableSorter=Class.create({initialize:function(b,a){this.element=$(b);this.sortIndex=a;this.sortOrder="desc";this.initDOMReferences();this.initEventHandlers()},initDOMReferences:function(){var b=this.element.down("thead");var a=this.element.down("tbody");if(!b||!a){throw"Table must have a head and a body to be sortable."}this.headers=b.down("tr").childElements();this.headers.each(function(d,c){if(!d.className.include("nosort")){d._colIndex=c}});this.body=a},initEventHandlers:function(){this.handler=this.handleHeaderClick.bind(this);this.element.observe("click",this.handler)},handleHeaderClick:function(b){var a=b.element();if(!("_colIndex" in a)){a=a.ancestors().find(function(c){return"_colIndex" in c});if(!((a)&&"_colIndex" in a)){return}}this.sort(a._colIndex,(a.className||""))},resort:function(a,b){this.sort(a,b);this.sort(a,b)},adjustSortMarkers:function(a){if(this.sortIndex!=-1){this.headers[this.sortIndex].removeClassName("sort-"+this.sortOrder)}if(this.sortIndex!=a){this.sortOrder="asc";this.sortIndex=a}else{this.sortOrder=("asc"==this.sortOrder?"desc":"asc")}this.headers[a].addClassName("sort-"+this.sortOrder)},sort:function(b,d){this.adjustSortMarkers(b);var c=this.body.childElements();c=c.sortByColumnHead(d,function(e){return e.childElements()[this.sortIndex].collectTextNodes()}.bind(this));if("desc"==this.sortOrder){c.reverse()}c.reverse().each(function(f,e){if(e>0){this.body.insertBefore(f,c[e-1])}}.bind(this));c.reverse().each(function(f,e){f.removeClassNames(["odd","even"]);(1==e%2)?f.addClassName("odd"):f.addClassName("even")});var a=this.element.up("form");if(a!=undefined){if(a.alphaOrder!=undefined){a.alphaOrder.value=this.sortIndex==2;a.ascDescOrder.value=this.sortOrder}}}});function unformat(a){a=a.trim();return a.replace(/[^0-9]/g,"")}var TableSortObserver={sortableTables:{},bindEventsToTableRow:function(a){defaultSortIndex=-1;$(a).down("thead").down("tr").childElements().each(function(c,b){if(c.className.include("sort")){defaultSortIndex=b}});this.sortableTables[a]=new TableSorter(a,defaultSortIndex)}};var InfoBubble=Class.create({initialize:function(a){this.triggerId=a.triggerId;this.contentId=a.contentId;this.options=a.options;this.clearTip=Boolean(a.clearTip);this.updateURL=a.updateURL;this.bubbleZoneID=a.infoBubbleZoneId;this.loadOnce=a.loadOnce;this.disablePrintReadOnly=a.disablePrintReadOnly;this.showOnLoad=a.showOnLoad;if(this.disablePrintReadOnly){this.windowsCtrlPrintMsg=a.windowsCtrlPrintMsg}if(this.options.showOn=="mousemove"){if(!InfoBubble.StorageMouseMove){Event.observe(document,"mousemove",this.handleMouseMove.bind(this));InfoBubble.StorageMouseMove=$H()}InfoBubble.StorageMouseMove.set(this.triggerId,this);this.eventToUse="mouseover"}else{if(!InfoBubble.StorageClick){Event.observe(document,"click",this.handleClick.bind(this));InfoBubble.StorageClick=$H()}InfoBubble.StorageClick.set(this.triggerId,this);this.eventToUse="click"}if(!InfoBubble.StorageKey){InfoBubble.StorageKey=$H();Event.observe(document,"keypress",this.handleKeypress.bind(this))}InfoBubble.StorageKey.set(this.triggerId,this)},handleKeypress:function(b){if(b.keyCode==32||b.charCode==32){var a=b.findElement();if(a){var c=InfoBubble.StorageKey.get(a.id);if(c==null){if((a.classList&&a.classList.contains("infobubble"))||(a.className&&a.className.indexOf("infobubble")!=-1)){a=$(a).up("div");if(a){c=InfoBubble.StorageKey.get(a.id)}}}if(c){Event.stop(b);c.simulateEvent(b)}}}},handleMouseMove:function(b){var a=b.findElement();if(a){var c=InfoBubble.StorageMouseMove.get(a.id);if(!c){if((a.classList&&a.classList.contains("infobubble"))||(a.className&&a.className.indexOf("infobubble")!=-1)){a=$(a).up("div");if(a){c=InfoBubble.StorageMouseMove.get(a.id)}}}if(c){InfoBubble.StorageMouseMove.unset(a.id);c.displayTip(b)}}},handleClick:function(b){var a=b.findElement();if(a){var c=InfoBubble.StorageClick.get(a.id);if(c){InfoBubble.StorageClick.unset(a.id);c.displayTip(b)}}},displayTip:function(b){this.targetElm=$(this.contentId);if(this.targetElm){if(!this.trigger){this.trigger=$(this.triggerId)}$T(this.trigger).zoneId=this.bubbleZoneID;try{new Tip(this.triggerId,this.targetElm,this.options);if(this.updateURL){this.trigger.observe("prototip:shown",this.ajaxLoadTip.bindAsEventListener(this))}if(this.disablePrintReadOnly){this.badKeys=new Object();this.badKeys.single=new Object();this.badKeys.alt=new Object();this.badKeys.ctrl=new Object();this.badKeys.ctrl["88"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["86"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["80"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["67"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["65"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["97"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["99"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["112"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["118"]=this.windowsCtrlPrintMsg;this.badKeys.ctrl["120"]=this.windowsCtrlPrintMsg;if(!this.clearTip){this.trigger.observe("prototip:hidden",this.reEnableMouseSelection.bindAsEventListener(this))}}this.simulateEvent(b)}catch(a){alert(a)}}},simulateEvent:function(a){if(!this.trigger){this.trigger=$(this.triggerId)}if(this.options.showOn=="mousemove"){this.trigger.simulate("mouseover");this.trigger.simulate("mousemove")}else{this.trigger.simulate(this.options.showOn)}},createAndShow:function(a){new Tip(this.triggerId,this.targetElm,this.options);return false},reEnableMouseSelection:function(a){document.onselectstart=function(){return true};document.onmousedown=function(){return true};document.stopObserving("keydown",this.keyDownEventHandler(this));document.stopObserving("keypress",this.keyPressEventHandler(this));return false},callNewTip:function(a){if(this.disablePrintReadOnly){document.onselectstart=function(){return true};document.onmousedown=function(){return true};document.stopObserving("keydown",this.keyDownEventHandler(this));document.stopObserving("keypress",this.keyPressEventHandler(this))}Tips.remove(this.triggerId);new Tip(this.triggerId,this.targetElm,this.options);return false},ajaxLoadTip:function(d){if(this.disablePrintReadOnly){document.onselectstart=function(){return false};document.onmousedown=function(){return false};var a=navigator.userAgent;var c=a.indexOf("Firefox");if(c>=0){document.observe("keypress",this.keyPressEventHandler.bindAsEventListener(this))}else{document.observe("keydown",this.keyDownEventHandler.bindAsEventListener(this))}}Event.stop(d);if(!this.loaded){var b=Tapestry.findZoneManager(this.trigger);if(!b){return}b.updateFromURL(this.updateURL);if(this.loadOnce){this.loaded=true}}return false},keyDownEventHandler:function(b){this.keyCode=(document.all)?b.keyCode:b.which;this.ctrlKey=b.ctrlKey;this.metaKey=b.metaKey;this.altKey=b.altKey;var a="single";if(this.ctrlKey){a="ctrl"}else{if(this.altKey){a="alt"}else{if(this.metaKey){a="ctrl"}}}if(this.checkKeyCode(a,this.keyCode)){return this.cancelKey(b,this.keyCode,this.getKeyText(a,this.keyCode))}},keyPressEventHandler:function(b){this.keyCode=(document.all)?b.keyCode:b.which;this.ctrlKey=b.ctrlKey;this.altKey=b.altKey;this.metaKey=b.metaKey;var a="single";if(this.ctrlKey){a="ctrl"}else{if(this.altKey){a="alt"}else{if(this.metaKey){a="ctrl"}}}if(this.checkKeyCode(a,this.keyCode)){return this.cancelKey(b,this.keyCode,this.getKeyText(a,this.keyCode))}},checkKeyCode:function(a,b){if(this.badKeys[a][b]){return true}else{return false}},cancelKey:function(c,b,a){if(c.type!=undefined&&(b=="112"||b=="80")){alert(a)}Event.stop(c);return false},getKeyText:function(a,b){return this.badKeys[a][b]}});InfoBubble.StorageMouseMove;InfoBubble.StorageClick;InfoBubble.StorageKey;Tapestry.Initializer.infoBubble=function(a){new InfoBubble(a)};var Disclaimer=Class.create();Disclaimer.prototype={initialize:function(b,a,c){if(a=="true"){elementId=$(b);this.url=c;this.showDisclaimer=a;Event.observe($(b),"click",this.showMessage.bindAsEventListener(this))}},showMessage:function(a){if(this.showDisclaimer=="true"){if($("findACopyOverlay")){Overlay.box.hideOverlay()}jQuery("#showDisclaimer").modal();$("hidden_outboundURL").value=this.url;a.stop()}},startsWithHttp:function(b){if(b==null){return false}var a=b.slice(0,4).toUpperCase();return(a=="HTTP"||a=="HTTPS")},redirect:function(d){var e=$$("#hidden_outboundURL");var a="";for(var b=0;b<e.length;b++){if(this.startsWithHttp(e[b].value)){a=e[b].value}}var c=window.open(a,"_blank");c.focus()}};